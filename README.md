# EcoGuardian - 空地协同森林火灾应急响应仿真系统

![Python](https://img.shields.io/badge/Python-3.9+-blue.svg) ![Pygame](https://img.shields.io/badge/Pygame-2.0+-green.svg) ![NumPy](https://img.shields.io/badge/NumPy-1.20+-orange.svg)

**EcoGuardian** 是一个面向多智能体系统（Multi-Agent System, MAS）教学与研究的 2D 仿真平台。本项目模拟了一个动态的森林火灾场景，展示了**异构智能体**（无人机与无人车）如何在具有物理特性的复杂环境中进行**感知、通信、决策与行动**的闭环协作。

---

## 📖 项目简介

在本项目中，森林环境基于**增强型元胞自动机（Cellular Automata）**模拟火势。系统包含两类智能体：
1.  **侦察无人机 (UAV)**：基于覆盖热力图进行智能巡逻，主动探索未知或久未观测的区域。
2.  **消防机器人 (UGV)**：具有水与电量限制，能够执行动态路径重规划，并在资源不足或长期空闲时自动返回补给站。

系统演示了“空地协同”模式：无人机建立全局热力图并发现火源，指挥中心基于贪心策略调度最近的机器人，机器人利用 **A* 算法** 规划路径、动态避障并完成灭火任务。

## ✨ 核心功能 (New Features)

*   **🔥 增强物理环境**：
    *   **动态风向**：仿真启动时随机生成风向（如西北风、南风），火势蔓延具有方向性偏好。
    *   **燃料系统**：树木燃烧消耗燃料，燃料耗尽后自动熄灭并转为焦土。
*   **🤖 智能体生存机制**：
    *   **资源限制**：机器人拥有**电量**（移动消耗）和**水量**（灭火消耗）。
    *   **自动补给**：当资源低于阈值或长期无任务时，机器人自动规划路径前往**补给站（Depot）**恢复状态。
*   **🧠 高级决策逻辑**：
    *   **UAV 智能巡逻**：基于“覆盖热力图”的贪婪探索算法，自动前往最久未被侦察的区域。
    *   **UGV 动态重规划**：移动中若发现路径被新火势阻挡，会立即触发 A* 重规划，而非原地等待。
*   **📊 实时可视化**：
    *   侧边栏实时显示风向、风力、资源统计及智能体状态。

## 🛠️ 技术架构

| 模块 | 描述 | 技术/算法 |
| :--- | :--- | :--- |
| **Environment** | 40x30 网格地图，含树、火、墙、焦土、**补给站**。 | CA + 风向向量计算 + 燃料衰减 |
| **Perception** | 无人机维护全局“扫描热力图”，寻找高紧迫度区域。 | 蒙特卡洛采样 (Monte Carlo) + 覆盖率计算 |
| **Decision** | 机器人状态机管理 (IDLE/MOVING/RETURNING)。 | 有限状态机 (FSM) + 贪心调度 |
| **Action** | 机器人寻路、避障与资源管理。 | **A* (A-Star) 动态重规划** |
| **Visualization** | 渲染循环与交互。 | Python / Pygame |

## 🎮 操作指南

仿真启动后，您将看到网格地图和智能体自动运行。

*   **键盘控制**：
    *   `SPACE` (空格): **随机点火**。手动在地图上增加火源。
    *   `R` 键: **完全重置**。重新生成地图、随机风向及智能体位置。
*   **界面说明**：
    *   🟦 **蓝色方块**：侦察无人机 (UAV)。
    *   🟨 **金色方块**：消防机器人 (UGV)。
    *   🟪 **紫色方块**：补给站 (Depot) - 机器人回血回蓝的地方。
    *   🟩 **绿色**：树木 / 🟫 **灰色**：障碍物。
    *   🟥 **红色**：正在蔓延的火源 / ⬛ **深灰**：已被扑灭的焦土。
    *   **侧边栏**：显示当前风向 (Wind) 及强度。

## 📂 目录结构

```text
EcoGuardian/
├── assets/                 # 资源文件夹
├── configs/
│   └── settings.py         # 全局配置 (物理参数, 资源阈值, 颜色)
├── core/
│   ├── grid_map.py         # 地图类 (含风向、燃料、热力图逻辑)
│   └── pathfinding.py      # A* 寻路算法
├── agents/
│   ├── base_agent.py       # 智能体基类
│   ├── drone.py            # UAV 智能巡逻逻辑 (热力图采样)
│   └── robot.py            # UGV 状态机 (灭火/补给/重规划)
├── main.py                 # 程序入口 (Pygame 主循环)
└── requirements.txt        # 依赖列表
```

## 🚀 后续扩展方向 (Future Work)

1.  **强化学习 (RL)**：将现有环境封装为 Gym 接口，训练 UAV 预测火势走向。
2.  **复杂通信**：引入通信距离限制，模拟真实世界的信号衰减。
3.  **多火点策略**：优化调度算法，处理大规模并发火灾时的任务聚类。
```