# EcoGuardian：空地协同森林火灾应急响应仿真系统技术方案

## 1. 项目概述 (Project Overview)

### 1.1 项目背景
本实验旨在设计并实现一个面向应用的 AI 智能体系统，模拟复杂环境下的多智能体协作（Multi-Agent Collaboration）。选取“森林火灾应急响应”为场景，构建一个包含**感知（Perception）**、**决策（Decision）**与**行动（Action）**能力的异构多智能体系统。

### 1.2 实验目标
*   **模拟动态环境**：基于元胞自动机（Cellular Automata）实现火势的随机蔓延与环境交互。
*   **异构协同**：实现无人机（UAV）与消防机器人（UGV）两种不同能力智能体的分工配合。
*   **算法验证**：验证 A* 路径规划算法与贪心/黑板模式的任务分配策略。
*   **可视化演示**：开发基于 Python/Pygame 的实时仿真界面。

---

## 2. 系统架构设计 (System Architecture)

系统采用分层架构设计，确保逻辑解耦与可扩展性。

| 层级 | 模块名称 | 功能描述 |
| :--- | :--- | :--- |
| **表现层** | GUI Renderer | 基于 Pygame 实现 60FPS 的网格渲染、动画效果与 UI 统计。 |
| **协作层** | Task Scheduler | 负责全局信息的汇聚（黑板模式）与任务分发（坐标指派）。 |
| **智能体层** | Agent Logic | 封装 UAV 和 UGV 的状态机、感知范围与动作接口。 |
| **算法层** | Core Algorithms | 包含路径规划（A*）、环境演化（CA）、碰撞检测。 |
| **数据层** | Grid Map | 基于 NumPy 的矩阵存储，维护地形（树/空地/墙）与火情状态。 |

---

## 3. 详细功能规格 (Detailed Specifications)

### 3.1 环境模型：元胞自动机
地图被划分为 $N \times M$ 的网格，每个格子拥有以下状态：
*   **0 (Empty)**: 空地，不可燃烧，可通行。
*   **1 (Tree)**: 树木，可被引燃，可通行。
*   **2 (Fire)**: 火焰，会向四周蔓延，不可通行（除非灭火）。
*   **3 (Wall)**: 障碍物，不可通行，不可燃烧。

**蔓延规则**：
每隔 $T$ 时间步，遍历所有状态为 `Fire` 的格子，以概率 $P$ 引燃其 8-邻域内状态为 `Tree` 的格子。

### 3.2 智能体角色定义

#### A. 侦察无人机 (Scout Drone)
*   **属性**：
    *   **速度**：快 (2 格/步)
    *   **视野**：广 (5x5 区域)
    *   **能力**：无灭火能力，可穿越低矮障碍。
*   **行为逻辑**：
    *   **巡逻模式**：按照预设的“割草机”路径（覆盖全图）或随机游走扫描地图。
    *   **感知共享**：一旦视野内检测到 `Fire` 状态，立即将坐标写入全局“已知火情列表”。

#### B. 消防机器人 (Fire Bot)
*   **属性**：
    *   **速度**：慢 (1 格/步)
    *   **视野**：窄 (3x3 区域)
    *   **能力**：具备灭火水枪，需携带水量（可选），无法穿越障碍。
*   **行为逻辑**：
    *   **待命模式**：当无任务时原地待命。
    *   **响应模式**：接收到目标坐标后，调用路径规划算法前往。
    *   **灭火动作**：到达火源邻近格后，执行 `Extinguish` 操作，将 `Fire` 重置为 `Empty` 或 `Burnt`。

### 3.3 协作与决策机制
系统采用 **“黑板模式 (Blackboard Pattern)”** 进行协作：
1.  **信息汇聚**：所有 UAV 将感知到的局部环境更新到全局的“黑板”（虚拟热力图）上。
2.  **任务分配**：
    *   调度器不断检查“黑板”上的活跃火点。
    *   计算每个火点到所有空闲 UGV 的曼哈顿距离。
    *   采用 **贪心策略 (Greedy Strategy)**：将火点分配给距离最近的空闲 UGV。

---

## 4. 关键算法说明 (Key Algorithms)

### 4.1 A* 路径规划 (A-Star Pathfinding)
用于 UGV 在复杂障碍物环境中寻找从当前位置到火源的最短路径。
*   **公式**：$F = G + H$
    *   $G$: 从起点到当前格的实际移动代价。
    *   $H$: 当前格到终点的估算代价（曼哈顿距离）。
*   **实现**：维护 OpenList 和 ClosedList，确保避开障碍物与正在燃烧的区域（防止机器人自毁）。

### 4.2 动态环境演化
使用 NumPy 矩阵操作优化元胞自动机性能：
```python
# 伪代码示例
if random.random() < SPREAD_PROBABILITY:
    neighbor_cell.state = FIRE
```

---

## 5. 项目代码结构 (Directory Structure)

```text
EcoGuardian/
├── assets/                 # 图片资源文件
├── configs/
│   └── settings.py         # 全局参数配置（地图尺寸、颜色、概率因子）
├── core/
│   ├── grid_map.py         # 地图类与火势蔓延逻辑
│   ├── pathfinding.py      # A* 寻路算法实现
│   └── utils.py            # 通用工具函数
├── agents/
│   ├── base_agent.py       # 智能体基类
│   ├── drone.py            # 无人机巡逻逻辑
│   └── robot.py            # 机器人灭火逻辑
├── main.py                 # 程序入口与 Pygame 主循环
└── requirements.txt        # Python 依赖库
```

---

## 6. 预期效果与评估

*   **功能演示**：
    *   启动后，可以看到绿色森林中随机出现红点（起火）。
    *   蓝色三角形（无人机）飞过火区，红色方块（机器人）随后启动并前往灭火。
    *   界面左上角实时显示：`存活树木数量`、`已扑灭火源数`。
*   **扩展性（针对 RTX 4060）**：
    *   预留 **RL 接口**：将 `Agent.decide()` 方法预留为强化学习模型输入接口，未来可接入 PPO/DQN 算法，利用 GPU 加速训练智能体在火势蔓延极快的情况下的最优围堵策略。
